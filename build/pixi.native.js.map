{"version":3,"file":"pixi.native.js","sourceRoot":"","sources":["../src/pixi.native.ts"],"names":[],"mappings":"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","sourcesContent":["import \"@expo/browser-polyfill\";\n\nimport { Asset } from \"expo-asset\";\nimport { ExpoWebGLRenderingContext } from \"expo-gl\";\nimport * as filters from \"pixi-filters\";\nimport * as PIXIInstance from \"pixi.js\";\nimport { PixelRatio } from \"react-native\";\n\ninterface ApplicationOptions extends PIXIInstance.ApplicationOptions {\n  context: ExpoWebGLRenderingContext;\n}\n\n// Override PIXI.Application to accept expo-gl context:\n// https://pixijs.download/v4.8.9/docs/PIXI.Application.html\nclass PIXIApplication extends PIXIInstance.Application {\n  constructor({\n    context,\n    width,\n    height,\n    resolution,\n    ...props\n  }: ApplicationOptions) {\n    if (!context) {\n      throw new Error(\"PIXI context must be a valid WebGL context.\");\n    }\n\n    // Shim stencil buffer attribute for PIXI.js check:\n    // https://github.com/pixijs/pixijs/blob/359a131eb10485947874b9a48bc2d62c1ee0b1a1/src/core/renderers/webgl/utils/validateContext.js#L6=\n    const originalGetContextAttributes =\n      context.getContextAttributes || (() => ({}));\n    context.getContextAttributes = () => {\n      return {\n        ...originalGetContextAttributes(),\n        stencil: true,\n      };\n    };\n\n    const targetResolution = resolution ?? PixelRatio.get();\n    const targetWidth = width ?? context.drawingBufferWidth / targetResolution;\n    const targetHeight =\n      height ?? context.drawingBufferHeight / targetResolution;\n\n    super({\n      context,\n      resolution: targetResolution,\n      width: targetWidth,\n      height: targetHeight,\n      ...props,\n    });\n\n    this.ticker.add(() => context.endFrameEXP());\n  }\n}\n\nclass PIXISprite extends PIXIInstance.Sprite {\n  static from(asset) {\n    if (isAsset(asset)) {\n      // @ts-ignore https://github.com/expo/browser-polyfill/blob/master/src/DOM/HTMLImageElement.js#L62=L73\n      const image = new global.HTMLImageElement(asset);\n      image.onerror = (e) => console.log(`Asset errored ${asset.name}`, e);\n\n      return PIXIInstance.Sprite.from(image);\n    } else if (isPath(asset)) {\n      return spriteFromAssetAsync(asset);\n    } else {\n      return PIXIInstance.Sprite.from(asset);\n    }\n  }\n}\n\nclass PIXITexture extends PIXIInstance.Texture {\n  static from(asset) {\n    if (isAsset(asset)) {\n      // @ts-ignore https://github.com/expo/browser-polyfill/blob/master/src/DOM/HTMLImageElement.js#L62=L73\n      const image = new global.HTMLImageElement(asset);\n      image.onerror = (e) => console.log(`Asset errored ${asset.name}`, e);\n\n      return PIXIInstance.Texture.from(image);\n    } else if (isPath(asset)) {\n      return textureFromAssetAsync(asset);\n    } else {\n      return PIXIInstance.Texture.from(asset);\n    }\n  }\n}\n\n// It might happen that an asset uri starts with `file:` and not `file://`.\n// `expo-gl` expect a texture asset to have the slashes. Enforce the slashes.\nfunction fixFileUri(uri: string) {\n  return uri.startsWith(\"file:\") && !uri.startsWith(\"file://\")\n    ? \"file://\" + uri.substring(5)\n    : uri;\n}\n\n// https://github.com/expo/expo/blob/main/packages/expo-asset/src/ImageAssets.ts\nfunction getImageInfo(url: string): Promise<{\n  width: number;\n  height: number;\n}> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onerror = reject;\n    img.onload = () => {\n      resolve({\n        width: img.width,\n        height: img.height,\n      });\n    };\n    img.src = url;\n  });\n}\n\nfunction isAsset(resource: unknown): resource is Asset {\n  return resource instanceof Asset;\n}\n\nfunction isPath(resource: unknown): resource is string | number {\n  return typeof resource === \"string\" || typeof resource === \"number\";\n}\n\n// https://github.com/expo/expo/issues/10803#issuecomment-731612476\nasync function textureFromAssetAsync(resource: string | number) {\n  const asset = await Asset.fromModule(resource).downloadAsync();\n  asset.localUri = fixFileUri(asset.localUri!);\n  asset.type = asset.type; // TODO: remove x\n\n  const { width, height } = await getImageInfo(asset.localUri);\n  asset.width = width;\n  asset.height = height;\n\n  return PIXITexture.from(asset as any);\n}\n\nasync function spriteFromAssetAsync(resource: string | number) {\n  const texture = await textureFromAssetAsync(resource);\n  return PIXISprite.from(texture as any);\n}\n\nexport const PIXI = {\n  ...PIXIInstance,\n  filters: {\n    ...PIXIInstance.filters,\n    ...filters,\n  },\n  Application: PIXIApplication,\n  Texture: PIXITexture,\n  Sprite: PIXISprite,\n};\n"]}